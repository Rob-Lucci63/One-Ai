<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Coin - Ø¨Ø§Ø³ ÙØ§ÛŒØª Ø³ÛŒØ§Ù‡</title>
  <style>
    body { margin: 0; padding: 0; background: #121212; color: #eee; font-family: Tahoma, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; height: 100vh; user-select: none; overflow: hidden; }
    h1 { margin-top: 10px; font-size: 24px; }
    #battleCanvas { background: #222; border-radius: 10px; margin-top: 20px; touch-action: none; }
    #hpBar { width: 400px; height: 20px; background: #555; border-radius: 10px; overflow: hidden; margin-top: 10px; }
    #hpFill { height: 100%; background: #f44; width: 100%; transition: width .3s ease; }
    #livesDisplay, #winsDisplay, #info { margin-top: 10px; font-size: 16px; user-select: none; }
    /* Ø§ÙÚ©Øª Ø¯Ù…ÛŒØ¬ Ùˆ ÙˆÛŒÙ† */
    .effect { position: absolute; font-size: 24px; font-weight: bold; opacity: 1; animation: fadeUp 1s ease-out forwards; pointer-events: none; z-index: 9999; }
    .damage { color: #f44; }
    .win { color: #ffd700; font-size: 32px; }
    @keyframes fadeUp { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -100%) scale(1.5); } }
    /* Ø¯ÛŒØ§Ù„ÙˆÚ¯ Ù¾Ø§ÛŒØ§Ù† */
    #endDialog { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #333; color: #fff; padding: 20px; border-radius: 10px; display: none; text-align: center; z-index: 10000; }
    #endDialog button { margin-top: 10px; padding: 8px 16px; background: #f44; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    /* Ø¬ÙˆÛŒâ€ŒØ§Ø³ØªÛŒÚ© Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    #joystickContainer { position: fixed; bottom: 40px; left: 40px; width: 100px; height: 100px; background: #444a; border-radius: 50%; touch-action: none; display: none; z-index: 1000; }
    #joystickBase { position: relative; width: 100%; height: 100%; border-radius: 50%; background: #666; }
    #joystickStick { position: absolute; width: 50px; height: 50px; background: #f44; border-radius: 50%; top: 25px; left: 25px; transition: top .1s, left .1s; touch-action: none; }
  </style>
</head>
<body>
  <h1>Ø¨Ø§Ø³ ÙØ§ÛŒØª Happy Coin Ø³ÛŒØ§Ù‡</h1>
  <canvas id="battleCanvas"></canvas>
  <div id="hpBar"><div id="hpFill"></div></div>
  <div id="livesDisplay">Ø¬Ø§Ù† Ø´Ù…Ø§: 3</div>
  <div id="winsDisplay">Ø¨Ø±Ø¯Ù‡Ø§: 0</div>
  <div id="info">Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ù‡Ù¾ÛŒ Ú©ÙˆÛŒÙ† Ø³ÛŒØ§Ù‡</div>  <div id="endDialog">
    <div id="endText"></div>
    <button onclick="resetBattle()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
  </div>  <div id="joystickContainer">
    <div id="joystickBase"><div id="joystickStick"></div></div>
  </div><script>
  const canvas = document.getElementById('battleCanvas');
  const ctx = canvas.getContext('2d');
  const hpFill = document.getElementById('hpFill');
  const livesDisplay = document.getElementById('livesDisplay');
  const winsDisplay = document.getElementById('winsDisplay');
  const infoDisplay = document.getElementById('info');
  const endDialog = document.getElementById('endDialog');
  const endText = document.getElementById('endText');

  function resizeCanvas(){
    const size = Math.min(window.innerWidth - 40, 400);
    canvas.width = size;
    canvas.height = size;
    document.getElementById('hpBar').style.width = size + 'px';
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
  let playerHeart = { x: 0, y: 0, size: 20 };
  let coins = [];
  let bossHP = 56;
  let playerLives = 3;
  let damagePerClick = 4;
  const roundDuration = 15 * 1000;
  let currentRound = 'enemy';
  let roundTimer = roundDuration;
  let lastTimestamp = null;
  let gameOver = false;
  let lastClickTime = 0;
  let wins = parseInt(localStorage.getItem('wins')||'0');
  winsDisplay.textContent = 'Ø¨Ø±Ø¯Ù‡Ø§: ' + wins;

  const joystickContainer = document.getElementById('joystickContainer');
  const joystickStick = document.getElementById('joystickStick');
  let joystickActive = false;
  let joystickStart = { x:0, y:0 };
  let joystickPos = { x:0, y:0 };

  function showEffect(text, className, x, y) {
    const effect = document.createElement('div');
    effect.textContent = text;
    effect.className = `effect ${className}`;
    effect.style.left = x + 'px';
    effect.style.top = y + 'px';
    document.body.appendChild(effect);
    setTimeout(() => effect.remove(), 1000);
  }

  if(isMobile){ joystickContainer.style.display='block';
    joystickContainer.addEventListener('touchstart', e => { joystickActive=true; const t=e.touches[0]; joystickStart={x:t.clientX,y:t.clientY};});
    joystickContainer.addEventListener('touchmove', e => { if(!joystickActive)return; e.preventDefault(); const t=e.touches[0]; let dx=t.clientX-joystickStart.x, dy=t.clientY-joystickStart.y; const dist=Math.hypot(dx,dy), max=40; if(dist>max){dx=dx/dist*max;dy=dy/dist*max;} joystickPos={x:dx,y:dy}; joystickStick.style.left=25+dx+'px'; joystickStick.style.top=25+dy+'px';});
    joystickContainer.addEventListener('touchend',()=>{joystickActive=false;joystickPos={x:0,y:0};joystickStick.style.left='25px';joystickStick.style.top='25px';});
  }

  canvas.addEventListener('click', e => {
    if(currentRound==='player' && !gameOver){
      const now=Date.now(); if(now-lastClickTime<200) return; lastClickTime=now;
      bossHP-=damagePerClick;
      showEffect('-'+damagePerClick,'damage',e.clientX,e.clientY);
      if(bossHP<=0){ bossHP=0; gameOver=true; wins++; localStorage.setItem('wins',wins); winsDisplay.textContent='Ø¨Ø±Ø¯Ù‡Ø§: '+wins;
        showEffect('ğŸ‰ Ù¾ÛŒØ±ÙˆØ²ÛŒ!','win',canvas.offsetLeft+canvas.width/2,canvas.offsetTop+canvas.height/2);
        setTimeout(()=>{
          endText.textContent='ØªÙˆ Ø´Ú©Ø³ØªÙ… Ø¯Ø§Ø¯ÛŒ ÙˆÙ„ÛŒ Ù…Ù† Ø¨Ø±Ù…ÛŒÚ¯Ø±Ø¯Ù…! Ù‡Ø¯Ù Ø¨Ø¹Ø¯ÛŒ Ù…Ù† Ø§Ø±Ø² Ùˆ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ø±Ø²ÛŒÙ‡...';
          endDialog.style.display='block';
        },500);
      }
      updateUI();
    }
  });

  if(!isMobile){ canvas.addEventListener('mousemove', e=>{ const r=canvas.getBoundingClientRect(); playerHeart.x=e.clientX-r.left-playerHeart.size/2; playerHeart.y=e.clientY-r.top-playerHeart.size/2; }); }

  function spawnCoin(){ const edges=['left','right','top','bottom'], edge=edges[Math.floor(Math.random()*edges.length)]; let x,y,vx,vy,s=3; switch(edge){case'left':x=0;y=Math.random()*canvas.height;vx=s;vy=0;break;case'right':x=canvas.width;y=Math.random()*canvas.height;vx=-s;vy=0;break;case'top':x=Math.random()*canvas.width;y=0;vx=0;vy=s;break;case'bottom':x=Math.random()*canvas.width;y=canvas.height;vx=0;vy=-s;break;} coins.push({x,y,vx,vy,size:20}); }

  function drawHeart(x,y,size){ ctx.fillStyle='red'; ctx.beginPath(); ctx.moveTo(x+size/2,y+size/5); ctx.bezierCurveTo(x+size/2,y,x,y,x,y+size/3); ctx.bezierCurveTo(x,y+size*2/3,x+size/2,y+size*4/5,x+size/2,y+size); ctx.bezierCurveTo(x+size/2,y+size*4/5,x+size,y+size*2/3,x+size,y+size/3); ctx.bezierCurveTo(x+size,y,x+size/2,y,x+size/2,y+size/5); ctx.fill(); }

  function updateUI(){ hpFill.style.width = (bossHP/56*100)+'%'; livesDisplay.textContent='Ø¬Ø§Ù† Ø´Ù…Ø§: '+playerLives; }

  function resetBattle(){ bossHP=56; playerLives=3; currentRound='enemy'; roundTimer=roundDuration; gameOver=false; coins=[]; endDialog.style.display='none'; infoDisplay.textContent='Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ù‡Ù¾ÛŒ Ú©ÙˆÛŒÙ† Ø³ÛŒØ§Ù‡'; updateUI(); }

  function gameLoop(ts){ if(!lastTimestamp) lastTimestamp=ts; const d=ts-lastTimestamp; lastTimestamp=ts;
    if(!gameOver){ roundTimer-=d; if(roundTimer<=0){ roundTimer=roundDuration; currentRound=currentRound==='enemy'?'player':'enemy'; infoDisplay.textContent=currentRound==='enemy'?'Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ù‡Ù¾ÛŒ Ú©ÙˆÛŒÙ† Ø³ÛŒØ§Ù‡':'Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ø´Ù…Ø§'; if(currentRound==='player') alert('Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª! Ø¨Ù‡ Ø¨Ø§Ø³ Ø­Ù…Ù„Ù‡ Ú©Ù†!'); }
      if(currentRound==='enemy'){ if(Math.random()<0.02) spawnCoin(); coins.forEach(c=>{c.x+=c.vx; c.y+=c.vy;}); coins=coins.filter(c=>{ const dx=c.x+c.size/2-(playerHeart.x+playerHeart.size/2), dy=c.y+c.size/2-(playerHeart.y+playerHeart.size/2), dist=Math.hypot(dx,dy); if(dist<c.size/2+playerHeart.size/2){ playerLives--; updateUI(); if(playerLives<=0){ alert('ğŸ’” Ø¬Ø§Ù†Ø§Øª ØªÙ…ÙˆÙ… Ø´Ø¯! Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø®ØªÛŒ ğŸ˜¢'); resetBattle(); } return false; } return !(c.x<-20||c.x>canvas.width+20||c.y<-20||c.y>canvas.height+20); }); if(isMobile&&joystickActive){ playerHeart.x=Math.max(0,Math.min(canvas.width-playerHeart.size,playerHeart.x+joystickPos.x*0.15)); playerHeart.y=Math.max(0,Math.min(canvas.height-playerHeart.size,playerHeart.y+joystickPos.y*0.15)); } }
    }
    ctx.clearRect(0,0,canvas.width,canvas.height); drawHeart(playerHeart.x,playerHeart.y,playerHeart.size); coins.forEach(c=>{ ctx.fillStyle='#ffd700'; ctx.beginPath(); ctx.arc(c.x+c.size/2,c.y+c.size/2,c.size/2,0,2*Math.PI); ctx.fill(); }); requestAnimationFrame(gameLoop);
  }

  resetBattle(); requestAnimationFrame(gameLoop);
</script></body>
</html>