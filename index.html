<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Coin - Ø¨Ø§Ø³ ÙØ§ÛŒØª</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: #121212;
      color: #eee;
      font-family: Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      user-select: none;
    }
    #battleCanvas {
      background: #222;
      border-radius: 10px;
      margin-top: 20px;
      touch-action: none;
    }
    #hpDisplay, #livesDisplay {
      margin-top: 10px;
      font-size: 20px;
      font-weight: bold;
      user-select: none;
    }
    #info {
      margin-top: 10px;
      font-size: 16px;
      color: #aaa;
    }
    #joystickContainer {
      position: fixed;
      bottom: 40px;
      left: 40px;
      width: 100px;
      height: 100px;
      background: #444a;
      border-radius: 50%;
      touch-action: none;
      display: none;
      z-index: 1000;
    }
    #joystickBase {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #666;
    }
    #joystickStick {
      position: absolute;
      width: 50px;
      height: 50px;
      background: #f44;
      border-radius: 50%;
      top: 25px;
      left: 25px;
      transition: top 0.1s, left 0.1s;
      touch-action: none;
    }
  </style>
</head>
<body>
  <h1>Ø¨Ø§Ø³ ÙØ§ÛŒØª Happy Coin Ø³ÛŒØ§Ù‡</h1>
  <canvas id="battleCanvas" width="400" height="400"></canvas>
  <div id="hpDisplay">HP Ø¨Ø§Ø³: 56</div>
  <div id="livesDisplay">Ø¬Ø§Ù† Ø´Ù…Ø§: 3</div>
  <div id="info">Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ù‡Ù¾ÛŒ Ú©ÙˆÛŒÙ† Ø³ÛŒØ§Ù‡</div>  <div id="joystickContainer">
    <div id="joystickBase">
      <div id="joystickStick"></div>
    </div>
  </div><script>
  const canvas = document.getElementById('battleCanvas');
  const ctx = canvas.getContext('2d');
  const hpDisplay = document.getElementById('hpDisplay');
  const livesDisplay = document.getElementById('livesDisplay');
  const infoDisplay = document.getElementById('info');

  const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

  let playerHeart = { x: 180, y: 180, size: 20, speed: 5 };
  let coins = [];
  let bossHP = 56;
  let playerLives = 3;
  let roundTime = 15 * 1000;
  let currentRound = 'enemy';
  let roundTimer = roundTime;
  let lastTimestamp = null;
  let gameOver = false;
  
  const joystickContainer = document.getElementById('joystickContainer');
  const joystickStick = document.getElementById('joystickStick');
  let joystickActive = false;
  let joystickStart = {x:0,y:0};
  let joystickPos = {x:0,y:0};

  if(isMobile) {
    joystickContainer.style.display = 'block';
    joystickContainer.addEventListener('touchstart', e => {
      joystickActive = true;
      const t = e.touches[0];
      joystickStart = {x: t.clientX, y: t.clientY};
    });
    joystickContainer.addEventListener('touchmove', e => {
      if(!joystickActive) return;
      e.preventDefault();
      const t = e.touches[0];
      let dx = t.clientX - joystickStart.x;
      let dy = t.clientY - joystickStart.y;
      const maxDist = 40;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist > maxDist) { dx = dx/dist*maxDist; dy = dy/dist*maxDist; }
      joystickPos = {x: dx, y: dy};
      joystickStick.style.left = 25 + dx + 'px';
      joystickStick.style.top = 25 + dy + 'px';
    });
    joystickContainer.addEventListener('touchend', () => {
      joystickActive = false;
      joystickPos = {x:0,y:0};
      joystickStick.style.left = '25px';
      joystickStick.style.top = '25px';
    });
  }

  function spawnCoin() {
    const edges = ['left','right','top','bottom'];
    const edge = edges[Math.floor(Math.random()*edges.length)];
    let x,y,vx,vy;
    const speed = 3;
    switch(edge) {
      case 'left': x=0; y=Math.random()*canvas.height; vx=speed; vy=0; break;
      case 'right': x=canvas.width; y=Math.random()*canvas.height; vx=-speed; vy=0; break;
      case 'top': x=Math.random()*canvas.width; y=0; vx=0; vy=speed; break;
      case 'bottom': x=Math.random()*canvas.width; y=canvas.height; vx=0; vy=-speed; break;
    }
    coins.push({x,y,vx,vy,size:20});
  }

  if(!isMobile) {
    canvas.addEventListener('mousemove', e => {
      const rect = canvas.getBoundingClientRect();
      playerHeart.x = e.clientX - rect.left - playerHeart.size/2;
      playerHeart.y = e.clientY - rect.top - playerHeart.size/2;
    });
  }

  canvas.addEventListener('click', e => {
    if(currentRound === 'player' && !gameOver) {
      const rect = canvas.getBoundingClientRect();
      const cx = e.clientX - rect.left;
      const cy = e.clientY - rect.top;
      for(let i=0;i<coins.length;i++) {
        const c = coins[i];
        if(cx>c.x && cx<c.x+c.size && cy>c.y && cy<c.y+c.size) {
          bossHP--;
          hpDisplay.innerText = 'HP Ø¨Ø§Ø³: '+bossHP;
          coins.splice(i,1);
          if(bossHP<=0) { alert('ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ø¨Ø§Ø³ Ø±Ùˆ Ø´Ú©Ø³Øª Ø¯Ø§Ø¯ÛŒ!'); gameOver=true; }
          break;
        }
      }
    }
  });

  function drawHeart(x,y,size) {
    ctx.fillStyle = 'red';
    ctx.beginPath();
    ctx.moveTo(x+size/2,y+size/5);
    ctx.bezierCurveTo(x+size/2,y,x,y,x,y+size/3);
    ctx.bezierCurveTo(x,y+size*2/3,x+size/2,y+size*4/5,x+size/2,y+size);
    ctx.bezierCurveTo(x+size/2,y+size*4/5,x+size,y+size*2/3,x+size,y+size/3);
    ctx.bezierCurveTo(x+size,y,x+size/2,y,x+size/2,y+size/5);
    ctx.fill();
  }

  function resetBattle() {
    bossHP=56;
    playerLives=3;
    gameOver=false;
    coins=[];
    currentRound='enemy';
    roundTimer=roundTime;
    hpDisplay.innerText='HP Ø¨Ø§Ø³: '+bossHP;
    livesDisplay.innerText='Ø¬Ø§Ù† Ø´Ù…Ø§: '+playerLives;
    infoDisplay.innerText='Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ù‡Ù¾ÛŒ Ú©ÙˆÛŒÙ† Ø³ÛŒØ§Ù‡';
  }

  function update(delta) {
    if(gameOver) return;
    roundTimer -= delta;
    if(roundTimer <= 0) {
      roundTimer = roundTime;
      currentRound = currentRound==='enemy'?'player':'enemy';
      infoDisplay.innerText = currentRound==='enemy'?'Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ù‡Ù¾ÛŒ Ú©ÙˆÛŒÙ† Ø³ÛŒØ§Ù‡':'Ø¯ÙˆØ± ÙØ¹Ù„ÛŒ: Ø­Ù…Ù„Ù‡ Ø´Ù…Ø§';
      if(currentRound==='player') alert('Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª! Ø±ÙˆÛŒ Ø³Ú©Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†!');
    }

    if(currentRound==='enemy') {
      if(Math.random()<0.02) spawnCoin();
      coins.forEach(c => { c.x+=c.vx; c.y+=c.vy; });
      coins = coins.filter(c => {
        const dx=c.x+c.size/2-(playerHeart.x+playerHeart.size/2);
        const dy=c.y+c.size/2-(playerHeart.y+playerHeart.size/2);
        const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<(c.size/2+playerHeart.size/2)) {
          playerLives--;
          livesDisplay.innerText='Ø¬Ø§Ù† Ø´Ù…Ø§: '+playerLives;
          if(playerLives<=0) {
            alert('ğŸ’” Ø¬Ø§Ù†Ø§Øª ØªÙ…ÙˆÙ… Ø´Ø¯! Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø®ØªÛŒ ğŸ˜¢');
            resetBattle();
          }
          return false;
        }
        if(c.x<-20||c.x>canvas.width+20||c.y<-20||c.y>canvas.height+20) return false;
        return true;
      });
      if(isMobile && joystickActive) {
        playerHeart.x+=joystickPos.x*0.15;
        playerHeart.y+=joystickPos.y*0.15;
        playerHeart.x=Math.max(0,Math.min(canvas.width-playerHeart.size,playerHeart.x));
        playerHeart.y=Math.max(0,Math.min(canvas.height-playerHeart.size,playerHeart.y));
      }
    }
  }

  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawHeart(playerHeart.x,playerHeart.y,playerHeart.size);
    coins.forEach(c => {
      ctx.fillStyle='gold';
      ctx.beginPath();
      ctx.arc(c.x+c.size/2,c.y+c.size/2,c.size/2,0,Math.PI*2);
      ctx.fill();
    });
  }

  function gameLoop(timestamp) {
    if(!lastTimestamp) lastTimestamp=timestamp;
    const delta=timestamp-lastTimestamp;
    lastTimestamp=timestamp;
    update(delta);
    draw();
    requestAnimationFrame(gameLoop);
  }

  resetBattle();
  requestAnimationFrame(gameLoop);
</script></body>
</html>
